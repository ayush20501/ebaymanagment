<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ListFast.ai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Existing styles remain unchanged */
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header, Preview Modal, Image Modal, and Main Content (up to Form Section) remain unchanged -->

    <!-- Main Form -->
    <div class="grid lg:grid-cols-3 gap-12">
        <!-- Form Section -->
        <div class="lg:col-span-2">
            <form id="listing-form" class="bg-white rounded-2xl shadow-lg p-8">
                <!-- Quick Fill Button -->
                <div class="mb-8 flex justify-between items-center p-4 bg-green-50 border border-green-200 rounded-xl">
                    <button type="button" id="autofill-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center hover-lift">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Fill Sample Data
                    </button>
                    <span class="text-sm text-green-700 font-medium">Click to see how it works with example data</span>
                </div>

                <!-- Form Fields -->
                <div class="space-y-8">
                    <div>
                        <label class="block text-lg font-semibold text-gray-900 mb-3">Product Description *</label>
                        <textarea id="raw_text" required rows="5" placeholder="Describe your product in detail - include brand, model, features, condition details, etc." class="input-field w-full px-4 py-4 rounded-xl text-base resize-none"></textarea>
                        <p class="text-sm text-gray-500 mt-3">ðŸ’¡ The more detail you provide, the better our AI can optimize your listing for search and sales</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-lg font-semibold text-gray-900 mb-3">Price (Â£) *</label>
                            <input type="number" id="price_value" step="0.01" min="0.01" required placeholder="0.00" class="input-field w-full px-4 py-4 rounded-xl text-base">
                        </div>
                        <div>
                            <label class="block text-lg font-semibold text-gray-900 mb-3">Quantity *</label>
                            <input type="number" id="quantity" min="1" value="1" required class="input-field w-full px-4 py-4 rounded-xl text-base">
                        </div>
                        <div>
                            <label class="block text-lg font-semibold text-gray-900 mb-3">Condition *</label>
                            <select id="condition" required class="input-field w-full px-4 py-4 rounded-xl text-base">
                                <option value="">Select condition...</option>
                                <option value="NEW">New</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-lg font-semibold text-gray-900 mb-3">Currency *</label>
                            <select id="currency" required class="input-field w-full px-4 py-4 rounded-xl text-base">
                                <option value="GBP" selected>GBP (Â£)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Image Input Section -->
                    <div>
                        <label class="block text-lg font-semibold text-gray-900 mb-3">Product Images *</label>
                        <div class="space-y-4">
                            <div class="flex gap-2">
                                <button type="button" id="upload-image-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium hover-lift">
                                    ðŸ“· Upload Image
                                </button>
                                <input type="file" id="upload-image-input" accept="image/*" class="hidden">
                            </div>
                            <div id="images-container" class="space-y-2">
                                <div class="flex items-center gap-2">
                                    <input type="text" name="image_url" placeholder="Paste an image URL or upload above" class="image-input input-field flex-1 px-4 py-3 rounded-lg text-base">
                                    <button type="button" id="add-image-btn" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-lg">
                                        +
                                    </button>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">ðŸ“¸ You can upload images or paste HTTPS URLs. High-quality images improve sales significantly!</p>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button type="button" id="preview-btn" class="bg-blue-600 text-white py-4 px-8 rounded-xl text-lg font-semibold hover:bg-blue-700 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed hover-lift order-2 md:order-1">
                                Preview, Edit & Publish
                            </button>
                            <button type="submit" id="publish-btn" class="bg-green-600 text-white py-4 px-8 rounded-xl text-lg font-semibold hover:bg-green-700 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed hover-lift pulse-animation order-1 md:order-2">
                                Publish to eBay
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 text-center mt-3">
                            ðŸ’¡ Use "Preview" to review and edit your listing before publishing, or "Publish" to go live immediately
                        </p>
                    </div>
                </div>
            </form>
        </div>

        <!-- Info Panel (unchanged) -->
        <div class="space-y-6">
            <div class="bg-gradient-to-br from-blue-500 to-purple-600 text-white p-6 rounded-2xl">
                <h3 class="text-xl font-bold mb-4">âœ¨ AI-Powered Listing</h3>
                <ul class="space-y-3 text-blue-100">
                    <li>â€¢ Automatic keyword extraction</li>
                    <li>â€¢ SEO-optimized titles</li>
                    <li>â€¢ Perfect category detection</li>
                    <li>â€¢ Professional descriptions</li>
                    <li>â€¢ eBay best practices</li>
                </ul>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h3 class="text-lg font-bold text-gray-900 mb-4">ðŸ“ˆ Tips for Better Sales</h3>
                <ul class="space-y-3 text-sm text-gray-600">
                    <li class="flex items-start">
                        <span class="text-green-500 mr-2">âœ“</span>
                        Use high-quality, well-lit photos
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-500 mr-2">âœ“</span>
                        Include brand names and model numbers
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-500 mr-2">âœ“</span>
                        Mention any defects or wear honestly
                    </li>
                    <li class="flex items-start">
                        <span class="text-green-500 mr-2">âœ“</span>
                        Research competitive pricing
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- AI Status (unchanged) -->
    <div id="ai-status" class="hidden bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 mt-8">
        <div class="flex items-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-4"></div>
            <div>
                <h3 class="text-lg font-semibold text-blue-900">AI Processing Your Listing</h3>
                <p id="ai-status-text" class="text-blue-700 mt-1">Analyzing your product description...</p>
            </div>
        </div>
        <div class="mt-6">
            <div class="bg-white rounded-full h-3">
                <div id="ai-progress" class="bg-blue-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <script>
        // Existing functions (showAIStatus, hideAIStatus, updateAIProgress, openImageModal, closeImageModal) remain unchanged

        // Window load and auth status (unchanged)
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/auth-status');
                const data = await response.json();

                if (!data.is_logged_in) {
                    window.location.href = 'login.html';
                    return;
                } else if (!data.has_profile) {
                    window.location.href = 'display-profile.html';
                    return;
                } else if (!data.has_ebay_auth) {
                    window.location.href = 'ebay-auth.html';
                    return;
                }

                document.getElementById('user-email').textContent = data.email;

                try {
                    const profileResponse = await fetch('/profile');
                    const profileData = await profileResponse.json();
                    if (profileResponse.ok && profileData.profile && profileData.profile.profile_pic_url) {
                        document.getElementById('user-profile-pic').src = profileData.profile.profile_pic_url;
                    }
                } catch (error) {
                    console.error('Error loading profile image:', error);
                }
            } catch (error) {
                window.location.href = 'login.html';
            }
        });

        // Add new image input field on + click (unchanged)
        const addImageBtn = document.getElementById('add-image-btn');
        const imagesContainer = document.getElementById('images-container');

        addImageBtn.addEventListener('click', () => {
            const newRow = document.createElement('div');
            newRow.className = 'flex items-center gap-2';

            const newInput = document.createElement('input');
            newInput.type = 'text';
            newInput.name = 'image_url';
            newInput.placeholder = 'Paste an image URL or upload above';
            newInput.className = 'image-input input-field flex-1 px-4 py-3 rounded-lg text-base';

            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold text-lg';
            removeBtn.textContent = 'âˆ’';
            removeBtn.addEventListener('click', () => {
                newRow.remove();
            });

            newRow.appendChild(newInput);
            newRow.appendChild(removeBtn);
            imagesContainer.appendChild(newRow);
        });

        // Handle image upload (unchanged)
        const uploadBtn = document.getElementById('upload-image-btn');
        const uploadInput = document.getElementById('upload-image-input');

        uploadBtn.addEventListener('click', () => {
            uploadInput.click();
        });

        uploadInput.addEventListener('change', async () => {
            if (!uploadInput.files.length) return;

            const file = uploadInput.files[0];
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file.');
                return;
            }
            if (file.size > 10 * 1024 * 1024) {
                alert('Image file size must be less than 10MB.');
                return;
            }

            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch('/upload-profile-image', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (response.ok && data.status === 'success') {
                    const inputs = imagesContainer.querySelectorAll('input[name="image_url"]');
                    let emptyInput = null;
                    for (let input of inputs) {
                        if (!input.value.trim()) {
                            emptyInput = input;
                            break;
                        }
                    }

                    if (emptyInput) {
                        emptyInput.value = data.image_url;
                    } else {
                        addImageBtn.click();
                        const newInputs = imagesContainer.querySelectorAll('input[name="image_url"]');
                        newInputs[newInputs.length - 1].value = data.image_url;
                    }

                    alert('Image uploaded successfully!');
                } else {
                    alert('Image upload failed: ' + (data.error || 'Unknown error'));
                }
            } catch (err) {
                alert('Error uploading image: ' + err.message);
            }

            uploadBtn.disabled = false;
            uploadBtn.textContent = 'ðŸ“· Upload Image';
            uploadInput.value = '';
        });

        // Autofill button (unchanged)
        document.getElementById('autofill-btn').addEventListener('click', () => {
            document.getElementById('raw_text').value = "Sainsbury's Mackerel Fillets in Olive Oil 125g - Premium quality mackerel fillets preserved in olive oil. Perfect for sandwiches, salads, or as a healthy snack. Rich in omega-3 fatty acids and protein. Best before date clearly marked on tin.";
            document.getElementById('price_value').value = "19.99";
            document.getElementById('quantity').value = "3";
            document.getElementById('condition').value = "NEW";

            const firstImageInput = imagesContainer.querySelector('input[name="image_url"]');
            if (firstImageInput) {
                firstImageInput.value = "https://assets.sainsburys-groceries.co.uk/gol/1261448/1/640x640.jpg";
            }

            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('success-message').classList.add('hidden');

            const form = document.getElementById('listing-form');
            form.style.transform = 'scale(1.01)';
            form.style.transition = 'transform 0.2s ease';
            setTimeout(() => {
                form.style.transform = 'scale(1)';
            }, 200);
        });

        // Logout button (unchanged)
        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                await fetch('/logout', { method: 'POST' });
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout failed:', error);
            }
        });

        // Collect images from all inputs (unchanged)
        function collectImages() {
            const inputs = imagesContainer.querySelectorAll('input[name="image_url"]');
            const images = [];
            inputs.forEach(input => {
                const val = input.value.trim();
                if (val && val.startsWith('https://')) {
                    images.push(val);
                }
            });
            return images;
        }

        // Submit to publish
        async function submitToPublish(formData, button) {
            button.disabled = true;
            button.textContent = 'Publishing...';

            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('success-message').classList.add('hidden');

            showAIStatus('ðŸ¤– Analyzing your product description...', 10);
            setTimeout(() => updateAIProgress('ðŸ” Extracting keywords and metadata...', 25), 500);
            setTimeout(() => updateAIProgress('ðŸ“‚ Finding optimal eBay category...', 50), 1500);
            setTimeout(() => updateAIProgress('ðŸ“‹ Filling product specifications...', 75), 2500);
            setTimeout(() => updateAIProgress('âœï¸ Generating marketing description...', 90), 3500);

            try {
                const response = await fetch('/publish-item', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                const data = await response.json();

                if (response.ok) {
                    updateAIProgress('âœ… Published to eBay!', 100);
                    setTimeout(() => {
                        hideAIStatus();
                        localStorage.setItem('listing-success', JSON.stringify(data));
                        window.location.href = 'success.html';
                    }, 1000);
                } else {
                    hideAIStatus();
                    document.getElementById('error-message').textContent = data.error || 'Failed to publish listing';
                    document.getElementById('error-message').classList.remove('hidden');
                }
            } catch (error) {
                hideAIStatus();
                document.getElementById('error-message').textContent = 'Network error. Please try again.';
                document.getElementById('error-message').classList.remove('hidden');
            }

            button.disabled = false;
            button.textContent = 'Publish to eBay';
        }

        // Generate preview
        async function generatePreview(formData, button) {
            button.disabled = true;
            button.textContent = 'Generating Preview...';

            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('success-message').classList.add('hidden');
            document.getElementById('preview-error').classList.add('hidden');
            document.getElementById('preview-success').classList.add('hidden');

            showAIStatus('ðŸ¤– Analyzing your product description...', 10);
            setTimeout(() => updateAIProgress('ðŸ” Extracting keywords and metadata...', 25), 500);
            setTimeout(() => updateAIProgress('ðŸ“‚ Finding optimal eBay category...', 50), 1500);
            setTimeout(() => updateAIProgress('ðŸ“‹ Filling product specifications...', 75), 2500);
            setTimeout(() => updateAIProgress('âœï¸ Generating marketing description...', 90), 3500);

            try {
                const response = await fetch('/preview-item', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                const data = await response.json();

                if (response.ok) {
                    updateAIProgress('âœ… Preview Generated!', 100);
                    displayPreview(data);
                    setTimeout(() => {
                        hideAIStatus();
                        document.getElementById('preview-modal').classList.remove('hidden');
                    }, 1000);
                } else {
                    hideAIStatus();
                    document.getElementById('error-message').textContent = data.error || 'Failed to generate preview';
                    document.getElementById('error-message').classList.remove('hidden');
                }
            } catch (error) {
                hideAIStatus();
                document.getElementById('error-message').textContent = 'Network error. Please try again.';
                document.getElementById('error-message').classList.remove('hidden');
            }

            button.disabled = false;
            button.textContent = 'Preview, Edit & Publish';
        }

        // Display preview
        function displayPreview(data) {
            document.getElementById('preview-title').value = data.title || '';

            const descriptionText = data.description.text || '';
            document.getElementById('preview-description').value = descriptionText;

            const formattedPreview = document.getElementById('preview-description-formatted');
            formattedPreview.innerHTML = data.description.html || '<p class="text-gray-400 italic">No description provided</p>';

            const descriptionTextarea = document.getElementById('preview-description');
            descriptionTextarea.removeEventListener('input', updatePreviewDescription);
            descriptionTextarea.addEventListener('input', updatePreviewDescription);

            function updatePreviewDescription() {
                const text = descriptionTextarea.value;
                if (text.trim()) {
                    const formatted = text
                        .split('\n\n')
                        .filter(p => p.trim())
                        .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`)
                        .join('');
                    formattedPreview.innerHTML = formatted;
                } else {
                    formattedPreview.innerHTML = '<p class="text-gray-400 italic">No description provided</p>';
                }
            }

            const aspectsContainer = document.getElementById('preview-aspects');
            aspectsContainer.innerHTML = '';
            Object.entries(data.aspects || {}).forEach(([key, values]) => {
                const aspectDiv = document.createElement('div');
                aspectDiv.innerHTML = `
                    <label class="block text-sm font-medium text-gray-700 mb-2">${key}</label>
                    <input type="text" value="${values.join(', ')}" data-aspect="${key}" class="input-field w-full px-4 py-3 rounded-lg mb-2">
                `;
                aspectsContainer.appendChild(aspectDiv);
            });

            const currencySymbols = { GBP: 'Â£', USD: '$', EUR: 'â‚¬' };
            document.getElementById('preview-price-currency').textContent =
                `${currencySymbols[data.price?.currency] || data.price?.currency || 'GBP'} ${data.price?.value || '0.00'} ${data.price?.currency || 'GBP'}`;
            document.getElementById('preview-quantity').textContent = data.quantity || 1;
            document.getElementById('preview-condition').textContent = data.condition || 'NEW';

            const imagesContainer = document.getElementById('preview-images');
            imagesContainer.innerHTML = '';
            (data.images || []).forEach((url, index) => {
                const imgDiv = document.createElement('div');
                imgDiv.className = 'relative group';
                imgDiv.innerHTML = `
                    <img src="${url}" alt="Listing Image ${index + 1}" 
                         class="w-full h-32 object-cover rounded-lg border-2 border-gray-200 hover:border-blue-400 transition-colors cursor-pointer"
                         onclick="openImageModal('${url}')"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMiA5VjEzTTEyIDE3SDE2TTggMTdIMTJNOCAxM0gxMk04IDlIMTZNNCAxN1Y3QTIgMiAwIDAgMSA2IDVIMThBMiAyIDAgMCExIDIwIDdWMTdBMiAyIDAgMCExIDE4IDE5SDZBMiAyIDAgMCExIDQgMTdaIiBzdHJva2U9IiM2QjczODAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo='; this.className += ' opacity-50'">
                    <div class="absolute top-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">
                        ${index + 1}
                    </div>
                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg flex items-center justify-center">
                        <svg class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                `;
                imagesContainer.appendChild(imgDiv);
            });

            document.getElementById('preview-form').dataset.preview = JSON.stringify(data);
        }

        // Listing form submit
        document.getElementById('listing-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const images = collectImages();

            if (images.length === 0) {
                document.getElementById('error-message').textContent = 'At least one valid HTTPS image URL is required.';
                document.getElementById('error-message').classList.remove('hidden');
                document.getElementById('success-message').classList.add('hidden');
                return;
            }

            const formData = {
                raw_text: document.getElementById('raw_text').value.trim(),
                price: {
                    value: parseFloat(document.getElementById('price_value').value),
                    currency: document.getElementById('currency').value
                },
                quantity: parseInt(document.getElementById('quantity').value),
                condition: document.getElementById('condition').value,
                images: images
            };

            const button = document.getElementById('publish-btn');
            await submitToPublish(formData, button);
        });

        // Preview button
        document.getElementById('preview-btn').addEventListener('click', async () => {
            const images = collectImages();

            if (images.length === 0) {
                document.getElementById('error-message').textContent = 'At least one valid HTTPS image URL is required.';
                document.getElementById('error-message').classList.remove('hidden');
                document.getElementById('success-message').classList.add('hidden');
                return;
            }

            const formData = {
                raw_text: document.getElementById('raw_text').value.trim(),
                price: {
                    value: parseFloat(document.getElementById('price_value').value),
                    currency: document.getElementById('currency').value
                },
                quantity: parseInt(document.getElementById('quantity').value),
                condition: document.getElementById('condition').value,
                images: images
            };

            const button = document.getElementById('preview-btn');
            await generatePreview(formData, button);
        });

        // Preview form submit
        document.getElementById('preview-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const previewData = JSON.parse(document.getElementById('preview-form').dataset.preview || '{}');
            const button = document.getElementById('preview-form').querySelector('button[type="submit"]');
            button.disabled = true;
            button.textContent = 'Publishing...';

            previewData.title = document.getElementById('preview-title').value.trim();
            previewData.description.text = document.getElementById('preview-description').value.trim();

            const editedText = previewData.description.text;
            if (editedText.trim()) {
                const paragraphs = editedText
                    .split('\n\n')
                    .filter(p => p.trim())
                    .map(p => `<p>${p.trim().replace(/\n/g, '<br>')}</p>`);
                previewData.description.html = paragraphs.join('');
            } else {
                previewData.description.html = '<p>No description provided</p>';
            }

            const aspectInputs = document.getElementById('preview-aspects').querySelectorAll('input[data-aspect]');
            const editedAspects = {};
            aspectInputs.forEach(input => {
                const aspect = input.dataset.aspect;
                const values = input.value.split(',').map(v => v.trim()).filter(v => v);
                if (values.length) {
                    editedAspects[aspect] = values;
                }
            });
            previewData.aspects = editedAspects;

            if (!previewData.title) {
                document.getElementById('preview-error').textContent = 'Title is required.';
                document.getElementById('preview-error').classList.remove('hidden');
                document.getElementById('preview-success').classList.add('hidden');
                button.disabled = false;
                button.textContent = 'Publish to eBay';
                return;
            }

            try {
                const response = await fetch('/publish-item-from-preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(previewData),
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('preview-success').textContent = 'Published to eBay!';
                    document.getElementById('preview-success').classList.remove('hidden');
                    document.getElementById('preview-error').classList.add('hidden');

                    setTimeout(() => {
                        localStorage.setItem('listing-success', JSON.stringify(data));
                        window.location.href = 'success.html';
                    }, 1500);
                } else {
                    document.getElementById('preview-error').textContent = data.error || 'Failed to publish listing';
                    document.getElementById('preview-error').classList.remove('hidden');
                    document.getElementById('preview-success').classList.add('hidden');
                }
            } catch (error) {
                document.getElementById('preview-error').textContent = 'Network error. Please try again.';
                document.getElementById('preview-error').classList.remove('hidden');
                document.getElementById('preview-success').classList.add('hidden');
            }

            button.disabled = false;
            button.textContent = 'Publish to eBay';
        });

        // Close preview modal
        document.getElementById('close-preview').addEventListener('click', () => {
            document.getElementById('preview-modal').classList.add('hidden');
        });

        document.getElementById('cancel-preview').addEventListener('click', () => {
            document.getElementById('preview-modal').classList.add('hidden');
        });

        document.getElementById('preview-modal').addEventListener('click', (e) => {
            if (e.target.id === 'preview-modal') {
                document.getElementById('preview-modal').classList.add('hidden');
            }
        });
    </script>
</body>
</html>
